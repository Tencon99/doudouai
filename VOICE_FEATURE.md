# 语音输入功能

## 功能概述

doudouAI 现在支持语音输入功能，可以通过语音转文字的方式快速输入内容。该功能支持桌面端和移动端，并包含实时音频波形显示。

## 平台支持

- ✅ **桌面端** (Windows, macOS, Linux) - 点击触发
- ✅ **移动端** (Android, iOS) - 长按触发
- ✅ **实时波形显示** - 40-50个白色椭圆波形，根据音频强度实时跳动

## 使用方法

### 桌面端
1. 在输入区域找到麦克风图标 🎤
2. 点击麦克风图标开始录音
3. 说话时会显示波形动画和实时识别文本
4. 再次点击停止录音，识别结果会自动填入输入框

### 移动端
1. 在输入区域找到麦克风图标 🎤
2. **长按**麦克风图标开始录音
3. 保持长按状态说话，会显示波形动画
4. 松开手指停止录音，识别结果会自动填入输入框

## 权限要求

### Android
- `RECORD_AUDIO` - 录音权限
- `WRITE_EXTERNAL_STORAGE` - 存储临时音频文件
- `READ_EXTERNAL_STORAGE` - 读取音频文件

### iOS  
- `NSMicrophoneUsageDescription` - 麦克风使用权限
- `NSSpeechRecognitionUsageDescription` - 语音识别权限

## 功能特性

### 🎵 实时波形显示
- 45个白色椭圆波形
- 每个波形初始大小：宽度6px，高度12px
- 根据音频强度实时调整波形高度
- 平滑动画过渡效果

### 🗣️ 语音识别
- 支持实时语音转文字
- 多语言支持（跟随系统语言）
- 识别过程中显示临时结果
- 自动将结果追加到输入框

### 🎮 交互体验
- 桌面端：单击开始/停止
- 移动端：长按录音，松开停止
- 录音时按钮有视觉反馈（颜色变化、脉冲动画）
- 支持取消录音操作

## 技术实现

### 核心组件
- `VoiceService` - 语音录制和识别服务
- `VoiceWaveWidget` - 音频波形显示组件  
- `VoiceInputButton` - 语音输入按钮组件

### 主要依赖
- `speech_to_text: ^7.0.0` - 语音转文字
- `permission_handler: ^11.3.1` - 权限管理
- `record: ^5.0.4` - 音频录制

### 波形算法
- 使用Timer定时器生成模拟音频振幅数据
- 结合正弦波函数创建自然的波形变化
- 根据语音识别状态动态调整波形强度

## 故障排除

### 权限问题
如果语音功能无法使用，请检查：
1. 应用是否获得麦克风权限
2. 系统语音识别服务是否可用
3. 网络连接是否正常（某些语音识别需要网络）

### 性能优化
- 语音服务使用单例模式，避免重复初始化
- 录音文件存储在临时目录，自动清理
- 波形动画使用硬件加速，保证流畅性

## 更新日志

### v0.0.70
- ✨ 新增语音输入功能
- ✨ 实时音频波形显示
- ✨ 桌面端和移动端适配
- ✨ 多语言支持
- 🔧 权限配置完善 